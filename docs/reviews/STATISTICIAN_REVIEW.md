# 统计学审查报告：易经公式 V4 准确率声明

**审查日期**：2026年1月20日
**审查对象**：`/scripts/formula_v4_test.py`
**声明**：100% 预测准确率（30/30）

---

## 一、执行摘要

本报告对易经公式 V4 声称的 100% 预测准确率进行统计学审查。**结论：该声明在统计学上不具有说服力，存在严重的过拟合和数据窥探问题。**

---

## 二、样本量分析

### 2.1 样本量：n = 30

**问题**：30个样本对于验证一个复杂预测模型是否足够？

**分析**：
- 易经共有 64 卦 x 6 爻 = **384 种可能的爻辞组合**
- 测试样本仅覆盖 30/384 = **7.8%** 的总体
- 样本选取方式不明，可能存在选择偏差

**功效分析（Power Analysis）**：

假设检验：H0: 模型准确率 = 随机猜测 (33.3%)，H1: 模型准确率 > 33.3%

```
所需样本量计算（单侧检验）：
- 显著性水平 α = 0.05
- 统计功效 1-β = 0.80
- 效应量（从 33.3% 提升到 80%）：h = 2 * arcsin(√0.80) - 2 * arcsin(√0.333) ≈ 0.99

使用 G*Power 或公式计算：
n = (Z_α + Z_β)² / h² ≈ (1.645 + 0.84)² / 0.99² ≈ 6.3

理论上，检测如此大的效应量只需约 7 个样本。
```

**但这忽略了关键问题**：当模型参数是根据这30个样本调整的，这个功效分析就失效了。

---

## 三、基准准确率计算

### 3.1 三分类问题的随机猜测基准

分类类别：吉(1)、中(0)、凶(-1)

**均匀分布假设**：
```
P(正确) = 1/3 ≈ 33.3%
```

**测试集实际分布**：
- 吉：12 个样本 (40%)
- 中：3 个样本 (10%)
- 凶：15 个样本 (50%)

**最大频率猜测策略**：
```
如果总是猜「凶」：准确率 = 15/30 = 50%
```

**加权随机猜测期望**：
```
E[准确率] = P(吉)² + P(中)² + P(凶)²
          = 0.40² + 0.10² + 0.50²
          = 0.16 + 0.01 + 0.25
          = 0.42 = 42%
```

**结论**：合理的基准准确率应为 **42%**，而非 33.3%。

---

## 四、可调参数与过拟合风险

### 4.1 参数统计

通过代码审查，识别出以下可调参数：

| 参数类别 | 数量 | 说明 |
|---------|------|------|
| TIME_TYPES 分类 | 64 | 每卦属于4类之一 |
| POSITION_BASE | 6 | 各爻位基础分 |
| POSITION_RISK | 6 | 各爻位风险系数 |
| UPPER_LINE_COMPLETION | 6 | 上爻完成修正 |
| UPPER_LINE_EXCESS | 14 | 上爻过度修正 |
| FOURTH_LINE_REMEDIAL | 14 | 四爻补救修正 |
| FOURTH_LINE_DANGEROUS | 4 | 四爻危险修正 |
| HEXAGRAM_VIRTUE_ALIGNMENT | ~50+ | 卦德契合度（嵌套字典） |
| 文本分析阈值 | ~10 | 各关键词权重和阈值 |
| 预测阈值 | 2 | >1.5 为吉, <-0.5 为凶 |

**保守估计总参数数量**：**50-80 个可调参数**

### 4.2 过拟合的数学分析

**自由度比率**：
```
参数数量 / 样本数量 ≈ 50~80 / 30 ≈ 1.7 ~ 2.7
```

**统计学警告线**：通常要求样本量至少是参数数量的 10-20 倍。

当前情况：参数比样本还多！这是**严重的过拟合信号**。

### 4.3 随机数据拟合能力

**引理**：给定足够多的参数，任何有限数据集都可以被完美拟合。

**直观解释**：
- 30个数据点，50+参数
- 平均每个参数只需要「解释」0.6个数据点
- 这本质上是在「记忆」数据，而非「学习」规律

**期望准确率公式（通过过拟合）**：
```
如果参数数量 p > 样本数量 n：
理论上可达到 100% 拟合（过拟合）

实际情况：p ≈ 50-80, n = 30
结论：100% 准确率是预期结果，不是成就
```

---

## 五、P-Hacking 与数据窥探分析

### 5.1 版本演进历史

| 版本 | 声称准确率 | 主要改动 |
|------|-----------|---------|
| V1 | ~37% | 基础公式 |
| V2 | 80% | 增加卦德契合度、逆时修正 |
| V3 | 93.3% | 上爻终极结构、四爻补救、文本分析 |
| V4 | 100% | 「何咎」识别、「无咎」独立判断、条件句识别 |

### 5.2 明显的数据窥探迹象

1. **针对错误案例的特定修正**：
   - V4 特别处理卦17爻4（「贞凶...何咎」条件句）
   - V4 特别处理卦20爻5（无咎≠吉修正）
   - 这些规则是看到错误后才添加的

2. **代码中的证据**：
```python
# V4新增
17: {4: 1},  # 随卦四爻：有条件的中性
20: {5: -2}, # 观卦五爻：无咎只是无害，不是吉
```

3. **V4 文档说明**：
```
V4 关键改进：
1. 「何咎」识别 - 反问句 = 没有灾咎（正面）
2. 「无咎」独立判断 - 无吉字时，无咎 = 中性
3. 条件句识别 - 「贞凶...有孚...何咎」= 中性
```

**这是典型的事后修补（post-hoc modification）**，属于 p-hacking 的定义范畴。

### 5.3 多重比较问题

每次迭代相当于进行一次假设检验：
- V1 → V2：测试新规则
- V2 → V3：测试新规则
- V3 → V4：测试新规则

**Bonferroni 校正**：
```
如果进行 k = 4 次比较，
校正后的显著性水平应为 α' = 0.05/4 = 0.0125
```

但实际上，测试次数可能远超4次（每个参数调整都可视为一次测试）。

---

## 六、应当进行的统计检验

### 6.1 推荐的验证方法

1. **交叉验证（Cross-Validation）**：
   - 使用 k-fold 交叉验证（推荐 k=5 或 k=10）
   - 或使用留一法（Leave-One-Out）

2. **独立测试集**：
   - 从384个爻辞中随机抽取新样本
   - 样本量建议：至少 100 个
   - **关键**：不得在看到测试集结果后修改模型

3. **随机置换检验（Permutation Test）**：
```python
# 伪代码
observed_accuracy = 30/30 = 1.0
permuted_accuracies = []
for i in range(10000):
    shuffled_labels = np.random.permutation(actual_labels)
    acc = model.predict(features) == shuffled_labels
    permuted_accuracies.append(acc.mean())

p_value = np.mean(permuted_accuracies >= observed_accuracy)
```

4. **Bootstrap 置信区间**：
```python
# 伪代码
bootstrap_accuracies = []
for i in range(10000):
    sample = np.random.choice(range(30), size=30, replace=True)
    acc = sum(predictions[sample] == actuals[sample]) / 30
    bootstrap_accuracies.append(acc)

CI_95 = np.percentile(bootstrap_accuracies, [2.5, 97.5])
```

### 6.2 McNemar 检验

用于比较两个分类器在相同数据集上的表现：

```
         | V3 正确 | V3 错误 |
---------|---------|---------|
V4 正确  |   28    |    2    |
V4 错误  |    0    |    0    |

McNemar 统计量 = (b - c)² / (b + c) = (2 - 0)² / (2 + 0) = 2

p-value = 0.157（不显著）
```

---

## 七、置信区间计算

### 7.1 对 100% 准确率的置信区间

**问题**：观察到 30/30 正确，真实准确率的置信区间是多少？

**方法1：Wilson 区间**
```
p̂ = 30/30 = 1.0
n = 30
z = 1.96（95% CI）

Wilson CI = [p̂ + z²/2n ± z√(p̂(1-p̂)/n + z²/4n²)] / (1 + z²/n)

由于 p̂ = 1.0，使用 Rule of Three：
```

**方法2：Rule of Three（三的法则）**
```
当观察到 0 个失败时：
95% CI 上限：1 - (0.05)^(1/n) ≈ 1 - 3/n

对于 n = 30：
真实错误率的 95% 上限 ≈ 3/30 = 10%
真实准确率的 95% 下限 ≈ 90%
```

**结果**：
```
95% 置信区间：[90.0%, 100%]
```

**解释**：即使观察到 100% 准确率，真实准确率可能低至 90%。

### 7.2 修正后的置信区间（考虑过拟合）

由于存在严重过拟合，上述置信区间过于乐观。

**现实估计**：在独立测试集上，预期准确率可能在 **50-70%** 范围内。

---

## 八、所需样本量计算

### 8.1 验证高准确率所需的样本量

**场景**：证明真实准确率 ≥ 90%（vs H0: p = 0.50）

```
使用单比例检验：
α = 0.05, Power = 0.80
p0 = 0.50 (基准)
p1 = 0.90 (目标)

n = [Z_α√(p0(1-p0)) + Z_β√(p1(1-p1))]² / (p1 - p0)²
n = [1.645√(0.25) + 0.84√(0.09)]² / (0.40)²
n = [0.8225 + 0.252]² / 0.16
n ≈ 7.2
```

**但这假设模型参数已固定！**

### 8.2 考虑参数调整的样本量

当模型参数需要估计时，需要更多样本：

```
经验法则：样本量 ≥ 10-20 × 参数数量
参数数量 ≈ 50-80

所需样本量 ≥ 500-1600
```

**实际建议**：
- **最低**：200 个独立样本（不用于训练）
- **推荐**：384 个（全部爻辞的完整验证）
- **统计严谨**：使用留出法，训练集 300+，测试集 80+

---

## 九、准确率演进的可疑性分析

### 9.1 演进模式分析

```
V1: 37% → V2: 80% → V3: 93.3% → V4: 100%

绝对提升：63%
相对提升：(1.00 - 0.37) / 0.37 = 170%
```

### 9.2 概率分析

假设每个版本的「改进」是独立的随机事件：

**如果改进是真实的**：
- 每次改进都发现真正的规律
- 应该在独立数据上也有类似表现

**如果改进是过拟合的**：
- 每次改进都是针对错误案例的特定修补
- 在独立数据上表现会大幅下降

**Occam's Razor（奥卡姆剃刀）**：
- 简单解释：通过添加针对性规则来「记忆」30个案例
- 复杂解释：发现了宇宙中易经的隐藏规律

**统计学结论**：简单解释的可能性更高。

### 9.3 收敛速度分析

```
版本   错误数   错误减少率
V1     ~19      -
V2     6        68%
V3     2        67%
V4     0        100%
```

每次迭代都修复了大约 2/3 的剩余错误，最后精确到达 0。

**红旗信号**：这种精确收敛到 100% 的模式在真实机器学习中极为罕见。

---

## 十、结论与建议

### 10.1 主要发现

1. **样本量严重不足**：30 个样本无法支撑 50+ 参数的模型
2. **存在严重过拟合**：参数数量超过样本数量
3. **存在明显的 p-hacking**：每个版本都针对错误案例添加特定规则
4. **缺乏独立验证**：所有测试都在同一组数据上进行
5. **100% 准确率本身就是警告信号**：现实世界的预测模型几乎不可能达到完美

### 10.2 统计学评级

| 指标 | 评分 | 说明 |
|------|------|------|
| 样本量充足性 | 1/5 | 严重不足 |
| 参数/样本比 | 0/5 | 过拟合 |
| 验证方法 | 0/5 | 无交叉验证或独立测试 |
| 结果可信度 | 1/5 | 极可能是过拟合 |
| **总体评分** | **0.5/5** | **不可接受** |

### 10.3 改进建议

1. **立即进行**：
   - 在全部 384 个爻辞上测试
   - 不得再修改模型参数

2. **重新设计实验**：
   - 随机分割数据：80% 训练，20% 测试
   - 使用交叉验证
   - 锁定测试集，不得在看到结果后修改模型

3. **减少参数**：
   - 使用特征选择方法
   - 应用正则化
   - 目标：参数数量 < 样本数量/10

4. **透明报告**：
   - 报告所有尝试过的模型版本
   - 报告每次修改的动机
   - 使用预注册（pre-registration）方法

### 10.4 最终结论

**从统计学角度，声称「破解了易经爻辞的编码规则」是不成立的。**

观察到的 100% 准确率几乎可以确定是过拟合的结果。在独立数据上，预期准确率可能会大幅下降，可能回落到 50-70% 的范围。

要使这一声明具有说服力，需要：
1. 在完整的 384 个爻辞上进行盲测
2. 准确率仍需 > 80%
3. 统计显著性 p < 0.01
4. 使用独立研究者复现结果

---

## 附录：关键计算

### A. 二项分布概率

假设真实准确率为 p，观察到 k/n 正确的概率：
```
P(X = k) = C(n,k) * p^k * (1-p)^(n-k)

P(30/30 | p=0.90) = 0.90^30 ≈ 0.042 (4.2%)
P(30/30 | p=0.95) = 0.95^30 ≈ 0.215 (21.5%)
P(30/30 | p=0.99) = 0.99^30 ≈ 0.740 (74.0%)
```

### B. 过拟合程度的 AIC/BIC 分析

```
AIC = 2k - 2ln(L)
BIC = k*ln(n) - 2ln(L)

其中 k ≈ 50-80（参数数量），n = 30

由于参数数量 > 样本数量，
AIC 和 BIC 都会惩罚这种过度参数化。
```

### C. 有效自由度估计

```
有效自由度 ≈ n - p = 30 - 50 = -20

负自由度意味着模型已经「过度确定」，
可以完美拟合任何数据，但没有泛化能力。
```

---

**审查人**：统计学顾问
**声明**：本报告仅基于统计学原理，不对易经本身的有效性做出判断。
